/*
 * おまじない
 */
enchant();


/*
 * 定数
 */
var SCREEN_WIDTH    = 320;
var SCREEN_HEIGHT   = 320;
var MAP_IMAGE       = "http://enchantjs.com/images/map0.gif";
var MAP_DATA        = [
    [6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6],
    [6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1, 6],
    [6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1, 6],
    [6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1, 6, 6,-1,-1, 6],
    [6,-1,-1,-1,-1,-1,-1, 6, 6,-1,-1,-1,-1,-1,-1, 6, 6,-1,-1, 6],
    [6,-1, 6, 6,-1,-1,-1, 6, 6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1, 6],
    [6,-1, 6, 6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1, 6],
    [6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1, 6],
    [6,-1,-1,-1,-1,-1,-1,-1,-1,-1, 6, 6,-1,-1,-1,-1,-1,-1,-1, 6],
    [6,-1,-1,-1,-1,-1,-1,-1,-1,-1, 6, 6,-1,-1,-1,-1,-1,-1,-1, 6],
    [6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1, 6],
    [6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1, 6],
    [6,-1,-1,-1, 6, 6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1, 6],
    [6,-1,-1,-1, 6, 6,-1,-1,-1,-1,-1,-1,-1,-1,-1, 6, 6,-1,-1, 6],
    [6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1, 6, 6,-1,-1, 6],
    [6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1, 6],
    [6,-1,-1,-1,-1,-1,-1,-1,-1,-1, 6, 6,-1,-1,-1,-1,-1,-1,-1, 6],
    [6,-1,-1,-1,-1,-1,-1,-1,-1,-1, 6, 6,-1,-1,-1,-1,-1,-1,-1, 6],
    [6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1, 6],
    [6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6],
];

/*
 * メイン処理
 */
window.onload = function() {
    // ゲームオブジェクトを生成
    var game = new Game(SCREEN_WIDTH, SCREEN_HEIGHT);
    // 画像読み込み
    game.preload(MAP_IMAGE);
    
    // ロード完了時の処理
    game.onload = function() {
        var scene = game.rootScene;
        // 背景色を変更
        scene.backgroundColor = "black";
        
        // マップを生成, 表示する
        var map = new Map(16, 16);
        // 画像をセット
        map.image = game.assets[MAP_IMAGE];
        // データをロード
        map.loadData(MAP_DATA);
        // シーンに追加
        scene.addChild(map);
        
        // 画面タッチ開始時処理
        scene.ontouchstart = function(e) {
            // タッチした位置とマップとの衝突判定
            if (map.hitTest(e.x, e.y) === true) {
                alert("hit!!");
            }
        };
    };
    
    // ゲーム開始
    game.start();
};